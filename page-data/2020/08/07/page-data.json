{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020/08/07/","result":{"data":{"site":{"siteMetadata":{"title":"Pensando em Códigos"}},"markdownRemark":{"id":"1d7dde40-0833-5302-8cfc-70758541e98f","excerpt":"O que é Delegação? Delegação é um padrão de arquitetura do software orientado a objetos. Seu objetivo é estender a funcionalidade de uma classe delegando essa…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e4c60a064b0c9453067b3d7e7e7ae300/0a47e/kotlin.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAD4UlEQVQ4y43Ua0ybVRgH8LdDDd01kYURE4WoySZmuiUuDGNMpiZzi8mcy5TpELewDh29UN7Sy6AX2tIWYZBRF6J8WaKJM1n4NuKHGb8smnkdW4FSWnrBDUGkSFdQOc/f875tgbJpfJKTk/fkPL885zl5j7Ctcxjl3lG80BrCay1hHDeNo16MwqyLkUMTJVN9EgMWK/3tW0cL3vVY8Cr5rMSiT0l8YNFbyBZ8SoZuaa3QJjzUE0AGDa6g5nHSiBFq0Myi39TJsQKeXChjizJWeH9Mjo9uYS16yDpKR0zT6LP00p9tG5H2bKa0d1M+5uOYNx/j3wpB8AewGt3pHcYu5x04bBcp5XwEKVcxzbu3UtqzhVe44V7Mu4Lx9SwoowEozw9i/bk4TrgvYda2A/OOMiRbS2netY3utj2cQ1dhyjWYFP5bMvaAfxDChTBe7OzHZEsF5qzlmLGXY87xOP5wPiqh4CjjKEPXRqmfWWzDMsZnqYc5bAzPnhtAxLIfSUsFppr34HfrTqlSyqKMowydRbynW2Qs5S5S8JtfhfEo8N/kWAjbu75CwPgWZppewS/mlzFleR6/NT9HOTTpeIKh/TFwVMbmXSWKtGdTPibHhSBKu67hO0MdpvSHETO8jtvGVzFp3kc5dMb6DDHP0+CoXUpJtpYpUu6tiuyRhbwo6b6Or/VmTKprENa/i0TjUUwYDlEGfUlCWdq+G/O2J83S/qums+vgyeSm2oqEe2JA68NEnRZBtRoRbS2iDccpvoweoFlzBRsw+iHW33VL++P2PQr9mb/k6myauGDXxvPB0CkHAu+3YPQDEWPqesqg1Rx9E9OG/XRZ9C/ptdOsrWkODk2sQ8pp0ocFuzqeRROCnY/lGKztwJDKiZG6ZpLQEEfD2lO403CUPhM/ZqrGX0nUx4j/20suQxJ2daJdyhMbEqvQuGDLVXrjRA9u1n5IEjrM0eAZERP1KuoTL7Iq0206bRiHpjGKRo6adPEldwb1yZXqEnmVOjQTgvBTzSeUQTsooHIherqJzoufs4PNCXrbHMF7xgipDFFSN8aW0Wyl8tUYdfmVCj9Uf4ofa/ro55N+jJ30kFfsZ5WtMTpoHcMbZ8N0jKM1xvF/Q9skyKRLKHKocP2dy/Q9R4PVvdQiXmHbPRGqdI5inz1EBzh6eAXFGpS5DLMS6pIcszaLflN1BYGqL0hvuMqKO0P0FH/CdrtHaa8zxNGxHIr7oExGRRl1SqiFo8KNI1/yxl9jBT0jVMKfr7L2EdrB0V0crcyg+J+oQz5yreHbJaF3iB7k7+Hm7iEq5mjpCoq9/4WK+ahNnbD/AzYwcJQeQUYwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"kotlin-logo\"\n        title=\"kotlin-logo\"\n        src=\"/static/e4c60a064b0c9453067b3d7e7e7ae300/772e8/kotlin.png\"\n        srcset=\"/static/e4c60a064b0c9453067b3d7e7e7ae300/a1812/kotlin.png 50w,\n/static/e4c60a064b0c9453067b3d7e7e7ae300/7e516/kotlin.png 100w,\n/static/e4c60a064b0c9453067b3d7e7e7ae300/772e8/kotlin.png 200w,\n/static/e4c60a064b0c9453067b3d7e7e7ae300/5a46d/kotlin.png 300w,\n/static/e4c60a064b0c9453067b3d7e7e7ae300/e17e5/kotlin.png 400w,\n/static/e4c60a064b0c9453067b3d7e7e7ae300/0a47e/kotlin.png 600w\"\n        sizes=\"(max-width: 200px) 100vw, 200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>O que é Delegação?</h2>\n<p><a href=\"https://en.wikipedia.org/wiki/Delegation_pattern\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><strong>Delegação</strong></a> é um padrão de arquitetura do software orientado a objetos. Seu objetivo é estender a funcionalidade de uma classe delegando essa função para outro objeto que implemente a mesma interface.</p>\n<!-- Suponha que queremos que uma classe B tenha a funcionalidade da classe A e a condição [is A]() é satisfeita, ou seja, B seja um tipo de A. -->\n<h3>Tipos de delegação</h3>\n<ul>\n<li>Explicita - Pode ser implementada com qualquer linguagem</li>\n<li>Implícita - Usa recursos que a linguagem oferece para implementar a delegação</li>\n</ul>\n<h2>Delegação com Kotlin</h2>\n<p>Kotlin oferece instrumentos nativos para implementar delegação, tanto de classes como de propriedades.</p>\n<p>Essa característica da linguagem é interessante porque permite estender a funcionalidade da classe de uma forma menos trabalhosa. Não é necessário implementar os métodos das interfaces manualmente.</p>\n<!-- Outro aspecto importante é que a delegação permite implementar **herança múltipla**. -->\n<h3>A palavra reservada <strong><em>by</em></strong></h3>\n<p>Kotlin usa a palavra reservada <a href=\"https://kotlinlang.org/docs/reference/keyword-reference.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><strong><em>by</em></strong></a> para definir a <strong>classe delegada</strong>.</p>\n<h3>Exemplo de delegação de classe</h3>\n<p>Para análise e estudo, veremos um exemplo de delegação de classe em Kotlin e em Java implementado de várias formas.</p>\n<h4>Delegação sem usar <strong><em>by</em></strong></h4>\n<p>Vamos criar uma uma interface <strong>IFacade</strong> de uma <a href=\"https://en.wikipedia.org/wiki/Facade_pattern\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">fachada</a>, um data class <strong>Connection</strong> que contem dados de conexão e uma classe <strong>IntegrationX</strong> que implementa o método de conexão dessa interface:</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">interface</span> IFacade <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>connection<span class=\"token operator\">:</span> Connection<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">data</span> <span class=\"token keyword\">class</span> <span class=\"token function\">Connection</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">val</span> addr<span class=\"token operator\">:</span> String<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token function\">IntegrationX</span><span class=\"token punctuation\">(</span>connection<span class=\"token operator\">:</span> Connection<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> IFacade <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>connection<span class=\"token operator\">:</span> Connection<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"connected to \"</span> <span class=\"token operator\">+</span> connection<span class=\"token punctuation\">.</span>addr<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Abaixo vamos utilizar o padrão de delegação para estender a classe <strong>IntegrationX1</strong>, sem utilizar os recursos que a linguagem Kotlin nos oferece.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> <span class=\"token function\">IntegrationX1</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> integrationX<span class=\"token operator\">:</span> IFacade<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> IFacade <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        integrationX<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Reparem em dois pontos fundamentais:</p>\n<ul>\n<li>a classe <strong>delegante (IntegrationX1)</strong> e a classe <strong>delegada (IntegrationX)</strong> implementam a mesma interface.</li>\n<li>a classe <strong>delegante (IntegrationX1)</strong> faz referencia a classe <strong>delegada (IntegrationX)</strong>. </li>\n<li>a classe <strong>delegante (IntegrationX1)</strong> implementa o método da interface, mas quem executa é a classe <strong>delegada (IntegrationX)</strong>.</li>\n</ul>\n<h4>Como ficaria a implementação em Java</h4>\n<p>Escrevendo um pouco mais de código, teríamos a mesma classe escrita em Java. Usaremos ela para comparar com o código da nossa próxima classe implementada com a palavra reservada <strong><em>by</em></strong>.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">IntegrationX1</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">IFacade</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">IntegrationX</span> integrationX<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">IntegrationX1</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IntegrationX</span> integrationX<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>integrationX <span class=\"token operator\">=</span> integrationX<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>integrationX<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>Delegação com <strong><em>by</em></strong></h4>\n<p>A classe IntegrationX2 implementa o padrão de delegação utilizando o recurso que a linguagem Kotlin nos oferece. O código fica menor, mais limpo e elegante.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> <span class=\"token function\">IntegrationX2</span><span class=\"token punctuation\">(</span>connection<span class=\"token operator\">:</span> Connection<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> IFacade <span class=\"token keyword\">by</span> <span class=\"token function\">IntegrationX</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Ao gerarmos o <em>bytecode</em> e decompilarmos o código, veremos que a classe gerada se assemelha muito com a classe de exemplo IntegrationX1.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">IntegrationX2</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">IFacade</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token comment\">// $FF: synthetic field</span>\n   <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">IntegrationX</span> $$delegate_0<span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">public</span> <span class=\"token class-name\">IntegrationX2</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@NotNull</span> <span class=\"token class-name\">Connection</span> connection<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token class-name\">Intrinsics</span><span class=\"token punctuation\">.</span><span class=\"token function\">checkParameterIsNotNull</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">,</span> <span class=\"token string\">\"connection\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$$delegate_0 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntegrationX</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n\n   <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$$delegate_0<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>O que o compilador fez foi:</p>\n<ul>\n<li>colocar o delegado <strong>IntegrationX</strong> em um campo <strong>private final</strong> da classe delegante <strong>IntegrationX2</strong>.</li>\n<li>implementar todos os métodos da interface <strong>IFacade</strong> chamando o delegado <strong>IntegrationX</strong> em cada uma.</li>\n</ul>\n<h2>Conclusão</h2>\n<p>Particularmente eu não acho muito intuitivo o código da classe <strong>IntegrationX2</strong> usando a palavra-chave <strong>by</strong>, por isso é importante entender qual a intenção e o que está acontecendo por trás.</p>\n<h2>Referências</h2>\n<ul>\n<li><a href=\"https://kotlinlang.org/docs/reference/delegation.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Kotlin Delegation</a></li>\n</ul>","frontmatter":{"title":"Delegation Pattern em Kotlin","date":"07/08/20","isoDate":"2020-08-07T00:00:00+00:00","description":"Como funciona o <i>delegation pattern</i> ou padrão de delegação e como a linguagem Kotlin ajuda na sua utilização."}}},"pageContext":{"slug":"/2020/08/07/","previous":{"fields":{"slug":"/2020/07/17/"},"frontmatter":{"title":"JWT, recapitulando conceitos.","tags":["jwt","autenticação","autorização"]}},"next":null}}}